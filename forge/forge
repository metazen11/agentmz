#!/usr/bin/env bash
# Forge CLI wrapper - run from anywhere, uses cwd as workspace
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
REPO_ROOT="$(dirname "$SCRIPT_DIR")"

# Activate venv if exists
if [[ -f "$REPO_ROOT/venv/bin/activate" ]]; then
    source "$REPO_ROOT/venv/bin/activate"
elif [[ -f "$REPO_ROOT/.venv/bin/activate" ]]; then
    source "$REPO_ROOT/.venv/bin/activate"
fi

# Add repo to PYTHONPATH
export PYTHONPATH="$REPO_ROOT:$PYTHONPATH"

# Pass current directory as workspace if not specified
# Check if -w or --workspace is in args
if [[ ! "$*" =~ (-w[[:space:]]|--workspace[[:space:]]|--workspace=) ]]; then
    exec python -m forge --workspace "$(pwd)" "$@"
else
    exec python -m forge "$@"
fi
